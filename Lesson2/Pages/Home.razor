@page "/"

@if (personelList == null)
{
    <h1>Liste yükleniyor...</h1>
}
else
{
    <button type="button" class="btn btn-primary" @onclick="()=>Add()">+</button>

    <table class="table">
        <thead>
            <tr>
                <th scope="col">#</th>
                <th scope="col">
                    Adı
                    <input type="text" class="form-control" @oninput="(args)=> AdaGore(args.Value.ToString())" />
                </th>
                <th scope="col">
                    Soyadı
                    <input type="text" class="form-control" @oninput="(args)=> SoyadaGore(args.Value.ToString())" />
                </th>
                <th scope="col">
                    DogumTarihi
                    <input type="date" class="form-control" @oninput="(args)=> TariheGore(Convert.ToDateTime(args.Value))" />
                </th>
                <th scope="col">Mesleği</th>
                <th scope="col">Yaşı</th>
                <th scope="col">İşlemler</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var personel in personelList)
            {
                <tr>
                    <th scope="row">@personel.Id</th>
                    <td>@personel.Ad</td>
                    <td>@personel.Soyad</td>
                    <td>@personel.DogumTarihi</td>
                    <td>@personel.Meslegi</td>
                    <td>@personel.Yasi</td>
                    <td>
                        <button type="button" class="btn btn-danger" @onclick="() => Delete(personel.Id)">X</button>
                    </td>
                </tr>

            }
        </tbody>
    </table>

    <div class="btn-toolbar" role="toolbar" aria-label="Toolbar with button groups">
        <div class="btn-group me-2" role="group" aria-label="First group">
            @{
                int bolum = Count / 10;
            }
            <button type="button" class="btn btn-info" @onclick="()=>Paging(0, PageSize)">Başlangıç</button>
            <button type="button" class="btn btn-primary" @onclick="()=>Paging(0, PageSize)">1</button>
            @for (int i = 1; i < bolum; i++)
            {
                int skip = i * PageSize;

                if (i == 1)
                {
                    i++;
                }
                <button type="button" class="btn btn-primary" @onclick="()=>Paging(skip, PageSize)">@i</button>
            }
            @{
                int sonuncuDeger = bolum * PageSize;
            }
            <button type="button" class="btn btn-info" @onclick="()=>Paging(sonuncuDeger, PageSize)">Bitiş</button>
            <div>@Count</div>
        </div>
    </div>

}



@code {
    List<Personel> personelList;
    List<Personel> adaGoreList;
    List<Personel> soyadaGoreList;
    List<Personel> tariheGoreList;


    private int GetId { get; set; }
    public int PageSize { get; set; } = 10;
    public int Count { get; set; }

    public int FilterType { get; set; }

    protected override void OnInitialized()
    {
        FilterType = 0;
        personelList = FirstPage();
        Count = Personeller().Count();
    }

    List<Personel> FirstPage()
    {
        return Personeller().Skip(0).Take(PageSize).ToList();
    }

    void Paging(int skip, int take)
    {
        if (FilterType == 0)
        {
            personelList = Personeller().Skip(skip).Take(take).ToList();
            StateHasChanged();
        }
        else if (FilterType == 1)
        {
            personelList = adaGoreList.Skip(skip).Take(take).ToList();
            StateHasChanged();
        }
        else if (FilterType == 2)
        {
            personelList = soyadaGoreList.Skip(skip).Take(take).ToList();
            StateHasChanged();
        }
        else if (FilterType == 3)
        {
            personelList = tariheGoreList.Skip(skip).Take(take).ToList();
            StateHasChanged();
        }
    }

    private List<Personel> Personeller()
    {
        return new List<Personel>
        {
            new Personel
                {
                    Id = 1,
                    Ad = "Huseyin",
                    Soyad = "Kazan",
                    DogumTarihi =Convert.ToDateTime((new DateTime(1987,8,6).ToString("dd/MM/yyyy"))),
                    Meslegi = "Yazılım Geliştirici",
                    Yasi = 37
                },
            new Personel
             {
                 Id = 2,
                 Ad = "Hasan",
                 Soyad = "Kazan",
                 DogumTarihi = Convert.ToDateTime((new DateTime(2024,1,30).ToString("dd/MM/yyyy"))),
                 Meslegi = "Bebek",
                 Yasi = 3
             },
            new Personel
             {
                 Id = 3,
                 Ad = "Zeynel Abidin",
                 Soyad = "Kazan",
                 DogumTarihi = Convert.ToDateTime((new DateTime(2024,1,30).ToString("dd/MM/yyyy"))),
                 Meslegi = "Bebek",
                 Yasi = 3
             },
             new Personel
                {
                    Id = 4,
                    Ad = "Huseyin",
                    Soyad = "Kazan",
                    DogumTarihi = Convert.ToDateTime((new DateTime(1987,8,6).ToString("dd/MM/yyyy"))),
                    Meslegi = "Yazılım Geliştirici",
                    Yasi = 37
                },
                new Personel
                {
                    Id = 5,
                    Ad = "Huseyin",
                    Soyad = "Kazan",
                    DogumTarihi = Convert.ToDateTime((new DateTime(1987,8,6).ToString("dd/MM/yyyy"))),
                    Meslegi = "Yazılım Geliştirici",
                    Yasi = 37
                },
                new Personel
                {
                    Id = 6,
                    Ad = "Huseyin",
                    Soyad = "Kazan",
                    DogumTarihi = Convert.ToDateTime((new DateTime(1987,8,6).ToString("dd/MM/yyyy"))),
                    Meslegi = "Yazılım Geliştirici",
                    Yasi = 37
                },
                new Personel
                {
                    Id = 7,
                    Ad = "Huseyin",
                    Soyad = "Kazan",
                    DogumTarihi = Convert.ToDateTime((new DateTime(1987,8,6).ToString("dd/MM/yyyy"))),
                    Meslegi = "Yazılım Geliştirici",
                    Yasi = 37
                },
                new Personel
                {
                    Id = 8,
                    Ad = "Huseyin",
                    Soyad = "Kazan",
                    DogumTarihi = Convert.ToDateTime((new DateTime(1987,8,6).ToString("dd/MM/yyyy"))),
                    Meslegi = "Yazılım Geliştirici",
                    Yasi = 37
                },
                new Personel
                {
                    Id = 9,
                    Ad = "Huseyin",
                    Soyad = "Kazan",
                    DogumTarihi = Convert.ToDateTime((new DateTime(1987,8,6).ToString("dd/MM/yyyy"))),
                    Meslegi = "Yazılım Geliştirici",
                    Yasi = 37
                },
                new Personel
                {
                    Id = 10,
                    Ad = "Huseyin",
                    Soyad = "Kazan",
                    DogumTarihi = Convert.ToDateTime((new DateTime(1987,8,6).ToString("dd/MM/yyyy"))),
                    Meslegi = "Yazılım Geliştirici",
                    Yasi = 37
                },
                new Personel
                {
                    Id = 11,
                    Ad = "Huseyin",
                    Soyad = "Kazan",
                    DogumTarihi = Convert.ToDateTime((new DateTime(1987,8,6).ToString("dd/MM/yyyy"))),
                    Meslegi = "Yazılım Geliştirici",
                    Yasi = 37
                },
                new Personel
                {
                    Id = 12,
                    Ad = "Huseyin",
                    Soyad = "Kazan",
                    DogumTarihi = Convert.ToDateTime((new DateTime(1987,8,6).ToString("dd/MM/yyyy"))),
                    Meslegi = "Yazılım Geliştirici",
                    Yasi = 37
                },
                new Personel
                {
                    Id = 13,
                    Ad = "Huseyin",
                    Soyad = "Kazan",
                    DogumTarihi = Convert.ToDateTime((new DateTime(1987,8,6).ToString("dd/MM/yyyy"))),
                    Meslegi = "Yazılım Geliştirici",
                    Yasi = 37
                },
                new Personel
                {
                    Id = 14,
                    Ad = "Huseyin",
                    Soyad = "Kazan",
                    DogumTarihi = Convert.ToDateTime((new DateTime(1987,8,6).ToString("dd/MM/yyyy"))),
                    Meslegi = "Yazılım Geliştirici",
                    Yasi = 37
                },
                new Personel
                {
                    Id = 15,
                    Ad = "Huseyin",
                    Soyad = "Kazan",
                    DogumTarihi = Convert.ToDateTime((new DateTime(1987,8,6).ToString("dd/MM/yyyy"))),
                    Meslegi = "Yazılım Geliştirici",
                    Yasi = 37
                },
                new Personel
                {
                    Id = 16,
                    Ad = "Huseyin",
                    Soyad = "Kazan",
                    DogumTarihi = Convert.ToDateTime((new DateTime(1987,8,6).ToString("dd/MM/yyyy"))),
                    Meslegi = "Yazılım Geliştirici",
                    Yasi = 37
                },
                new Personel
                {
                    Id = 17,
                    Ad = "Huseyin",
                    Soyad = "Kazan",
                    DogumTarihi = Convert.ToDateTime((new DateTime(1987,8,6).ToString("dd/MM/yyyy"))),
                    Meslegi = "Yazılım Geliştirici",
                    Yasi = 37
                },
                new Personel
                {
                    Id = 18,
                    Ad = "Huseyin",
                    Soyad = "Kazan",
                    DogumTarihi = Convert.ToDateTime((new DateTime(1987,8,6).ToString("dd/MM/yyyy"))),
                    Meslegi = "Yazılım Geliştirici",
                    Yasi = 37
                },
                 new Personel
                {
                    Id = 19,
                    Ad = "Huseyin",
                    Soyad = "Kazan",
                    DogumTarihi = Convert.ToDateTime((new DateTime(1987,8,6).ToString("dd/MM/yyyy"))),
                    Meslegi = "Yazılım Geliştirici",
                    Yasi = 37
                },
                 new Personel
                {
                    Id = 20,
                    Ad = "Huseyin",
                    Soyad = "Kazan",
                    DogumTarihi = Convert.ToDateTime((new DateTime(1987,8,6).ToString("dd/MM/yyyy"))),
                    Meslegi = "Yazılım Geliştirici",
                    Yasi = 37
                },
                 new Personel
                {
                    Id = 21,
                    Ad = "Huseyin",
                    Soyad = "Kazan",
                    DogumTarihi = Convert.ToDateTime((new DateTime(1987,8,6).ToString("dd/MM/yyyy"))),
                    Meslegi = "Yazılım Geliştirici",
                    Yasi = 37
                }
        };
    }

    void IsOpen(int id)
    {
        GetId = id;
    }

    void Delete(int id)
    {
        var listtenGelen = personelList.Where(personelList => personelList.Id == id).FirstOrDefault();
        personelList.Remove(listtenGelen);
        StateHasChanged();
    }

    void AdaGore(string name)
    {
        FilterType = 1;
        adaGoreList = Personeller().Where(p => p.Ad.ToLower().Contains(name)).ToList();
        personelList = adaGoreList.Skip(0).Take(PageSize).ToList();
        Count = adaGoreList.Count();
    }
    void SoyadaGore(string name)
    {
        FilterType = 2;
        soyadaGoreList = Personeller().Where(p => p.Soyad.ToLower().Contains(name)).ToList();
        personelList = soyadaGoreList.Skip(0).Take(PageSize).ToList();
        Count = soyadaGoreList.Count();
    }

    void TariheGore(DateTime date)
    {
        DateTime guncelGelenTarih = Convert.ToDateTime(date.ToString("dd/MM/yyyy"));
        FilterType = 3;
        tariheGoreList = Personeller().Where(p => p.DogumTarihi == guncelGelenTarih).ToList();
        personelList = tariheGoreList.Skip(0).Take(PageSize).ToList();
        Count = tariheGoreList.Count();
    }

    void Add()
    {
        int gelenPersonelId = personelList.OrderByDescending(personelList => personelList.Id).FirstOrDefault().Id;

        gelenPersonelId++;
        personelList.Add(new Personel
            {
                Id = gelenPersonelId,
                Ad = "Mustafa",
                Soyad = "Demir",
                DogumTarihi = Convert.ToDateTime((new DateTime(1996, 8, 6).ToString("dd/MM/yyyy"))),
                Meslegi = "Araştırmacı",
                Yasi = 28
            });
        StateHasChanged();
    }
}
